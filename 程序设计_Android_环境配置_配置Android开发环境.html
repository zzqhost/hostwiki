<html>
  <head>
    <title>配置Android开发环境</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="Stylesheet" type="text/css" href="cssandjs/style.css" />
</head>


<body>


<div id="container">
    <div id="header">张志强的wiki</div>
    <br class="clearfloat" />
    <div id="content">

<p>
<a href="index.html">首页</a>
</p>

<h1 id="toc_1"> 配置Android开发环境</h1>
<div class="toc">
<ul>
<li><a href="#toc_1"> 配置Android开发环境</a>
<ul>
<li><a href="#toc_1.1">1. 前期准备</a>
<li><a href="#toc_1.2">2. 步骤</a>
<li><a href="#toc_1.3">3. 编译</a>
<ul>
<li><a href="#toc_1.3.1">3.1. 配置编译环境</a>
<li><a href="#toc_1.3.2">3.2. Building</a>
</ul>
<li><a href="#toc_1.4">4. 运行模拟器</a>
<li><a href="#toc_1.5">5. 安装软件并播放SD卡上的视频</a>
<ul>
<li><a href="#toc_1.5.1">5.1. 创建SD卡</a>
<li><a href="#toc_1.5.2">5.2. 向emulator的SD卡镜像写入数据</a>
<li><a href="#toc_1.5.3">5.3. 模拟器挂载SD卡镜像</a>
<li><a href="#toc_1.5.4">5.4. 安装apk包</a>
</ul>
<li><a href="#toc_1.6">6. 模拟器的相关操作</a>
</ul>
</ul>
</div>

<h2 id="toc_1.1">1. 前期准备</h2>
<ul>
<li>
首先，这里讲的是Ubuntu上如何配置。 ubuntu的版本为12.04或10.04均可, 需要64位。

<li>
已经下载下来了Android代码，如还没下载，请参考<a href="程序设计_Android_环境配置_如何下载Android源码.html">如何下载Android源码</a>来下载代码。我这里用的代码版本是Android4.1 JellyBean.

<li>
好了，开始配置了...

</ul>

<h2 id="toc_1.2">2. 步骤</h2>
<ul>
<li>
首先切换到root权限，以方便后续的操作

<ul>
<li>
$ sudo su

</ul>
<li>
安装需要的软件包（include git and subversion）
<pre>
aptitude -y install ant binutils binutils-dev binutils-static \
libncurses5-dev libncursesw5-dev ncurses-term ncurses-hexedit openssh-server \
gcc-4.2 g++-4.2 libstdc++5 libstdc++6-4.2 automake1.8 automake1.9 dialog libltdl3 \
build-essential libz-dev flex gperf libwxgtk2.6-dev libcurses-widgets-perl bison \
libcurses-perl libcurses-ui-perl libcurses-ruby libcurses-ruby1.8 python2.5 \
libsdl-dev valgrind ncurses-dev libtool libx11-dev vim vim-full exuberant-ctags \
meld pbzip2 wget wmii2 dwm bison htop iotop zip unzip fakeroot sun-java6-jdk \
cramfsprogs screen sysv-rc-conf subversion subversion-tools python-svn \
python-soappy git git-core git-svn sun-java6-jdk p7zip p7zip-full xlockmore \
mingw32 tofrodos tig tmux libsvn-perl sshfs gnuplot tree libc6-dev-i386 \
lib32z1-dev lib32ncurses5-dev libzzip-dev libc6-dev-amd64 g++-multilib \
lib64stdc++6 lib64z1-dev ia32-libs-sdl mutt txt2html splint squashfs-tools \
kpartx lsb-release tmux linux-server gnupg curl zlib1g-dev gcc-multilib \
x11proto-core-dev lib32readline5-dev lib32z-dev gawk cscope libqtcore4 \
xml2 wmctrl ant1.8
</pre>

</ul>

<pre>
    ln -s /usr/bin/fromdos /usr/local/bin/dos2unix
</pre>

<pre>
    aptitude -y purge nbSMTP exim4 exim4-base exim4-daemon-light
</pre>

<ul>
<li>
安装JDK1.6，并配置PATH变量

<ul>
<li>
首先，从网上下载最新版本的JDK1.6， 我下载的版本是：jdk-6u33-linux-x64.bin

<li>
安装

<ul>
<li>
$ chmod 777 jdk-6u33-linux-x64.bin

<li>
$ ./jdk-6u33-linux-x64.bin

</ul>
<li>
把上步解开的文件夹移动到系统路径中,并建立链接

<ul>
<li>
$ mv jdk1.6.0_33 /usr/local

<li>
$ ln -s /usr/local/jdk1.6.0_33 /usr/local/jdk1.6

</ul>
<li>
配置PATH
<pre>
echo " PATH=/usr/local/jdk1.6/bin:/usr/local/arm-linux/bin:\$PATH:
CLASSPATH=/usr/local/jdk1.6/lib:.
JAVA_HOME=/usr/local/jdk1.6
export PATH CLASSPATH JAVA_HOME
alias vi=vim
alias h=htop
alias screen='screen -R -DD'
export VISUAL=vim" &gt;&gt;/etc/bash.bashrc
</pre>

</ul>
</ul>

<h2 id="toc_1.3">3. 编译</h2>
<h3 id="toc_1.3.1">3.1. 配置编译环境</h3>
<ul>
<li>
$ . build/envsetup.sh （注意 . 后的空格）

<li>
$ lunch (全部采用默认，直接回车)

</ul>
    
<h3 id="toc_1.3.2">3.2. Building</h3>
<ul>
<li>
编译全部代码(可不用配置上步的编译环境)： 源码路径下执行以下命令

<ul>
<li>
$ make -j4

</ul>
</ul>

<ul>
<li>
按模块编译(可不用配置上步的编译环境)

<ul>
<li>
$ make mediaserver

<li>
$ make frameworks

<li>
模块编译会自动处理相关的一些依赖库。

</ul>
</ul>

<ul>
<li>
按路径编译部分代码(在源码根路径下, 必须配置上步编译环境)

<ul>
<li>
$ mmm frameworks/av/media/libstagefright/

<li>
$ mmm framworks/base/

<li>
此种方法只编译此路径下的代码，必须要有Android.mk,如果是java代码可不需要。

</ul>
</ul>

<ul>
<li>
编译完之后，如果需要把刚编译好的一个so或apk之类的烧到模拟器中，则运行下述命令

<ul>
<li>
$ make snod

</ul>
</ul>

<h2 id="toc_1.4">4. 运行模拟器</h2>
<ul>
<li>
只运行模拟器, 在源码路径下执行以下命令：

<ul>
<li>
$ . build/envsetup.sh

<li>
$ lunch

<li>
$ emulator &amp;

</ul>
<li>
带SD卡启动

<ul>
<li>
$ . build/envsetup.sh

<li>
$ lunch

<li>
$ emulator -sdcard ~/work/andord_lx/sdcard/sdcard.img &amp;

</ul>
<li>
带SD卡启动大屏幕

<ul>
<li>
$ . build/envsetup.sh

<li>
$ lunch

<li>
$ emulator -sdcard ~/work/andord_lx/sdcard/sdcard.img -skin NGB720P &amp;

</ul>
</ul>

<h2 id="toc_1.5">5. 安装软件并播放SD卡上的视频</h2>
<h3 id="toc_1.5.1">5.1. 创建SD卡</h3>
<ul>
<li>
例如创建一个名为sdcard.img的128M(M需大写）SD卡镜像到~/work/android_lx/sdcard/下 

<ul>
<li>
$ cd ~/work 

<li>
$ mkdir android_lx/sdcard -p 

<li>
$ cd android_lx/sdcard 

<li>
$ mksdcard 128M sdcard.img

</ul>
</ul>

<ul>
<li>
如果提示找不到mksdcard命令，则需要在源码路径下执行以下命令： 

<ul>
<li>
$ . build/envsetup.sh 

<li>
$ lunch

</ul>
</ul>

<h3 id="toc_1.5.2">5.2. 向emulator的SD卡镜像写入数据</h3>

<ol>
<li>
方法一(速度快，推荐) 

<ul>
<li>
$ sudo mkdir /mnt/sdcard 

<li>
$ sudo mount -o loop ~/work/android_lx/sdcard/sdcard.img /mnt/sdcard/ 

<li>
$ sudo cp ~/Video/shrek.mkv /mnt/sdcard/ 

<li>
$ ls -al /mnt/sdcard/ 

<li>
$ sudo umount /mnt/sdcard 

</ul>
<li>
方法二(速度慢，直观) 

<ul>
<li>
$ emulator -sdcard ~/work/android_lx/sdcard.img &amp;

<li>
$ adb push ~/Video/hahan.mp4 /sdcard 

<li>
$ adb shell 

<li>
$ ls /sdcard/ -l

</ul>
</ol>

<h3 id="toc_1.5.3">5.3. 模拟器挂载SD卡镜像</h3>
<ul>
<li>
$ emulator -sdcard ~/work/andord_lx/sdcard/sdcard.img &amp;

</ul>

<p>
这样启动模拟器后，模拟器就不会抱怨没有SD卡了。 
</p>

<h3 id="toc_1.5.4">5.4. 安装apk包</h3>

<p>
在确保模拟器已经启动的情况下 
</p>

<ul>
<li>
$ adb install ~/work/android_lx/SeeJoPlayer.apk

</ul>

<p>
如果提示找不到adb命令，则需要在源码路径下执行以下命令： 
</p>

<ul>
<li>
$ . build/envsetup.sh 

<li>
$ lunch

</ul>

<h2 id="toc_1.6">6. 模拟器的相关操作</h2>

<ol>
<li>
进入Android shell 

<ul>
<li>
$ adb shell 

</ul>
<li>
在模拟器中打印LOG 

<ul>
<li>
$ logcat 

</ul>
<li>
退出模拟器shell 

<ul>
<li>
$ exit 

</ul>
<li>
调整横坚屏 

<ul>
<li>
Ctrl+F12

</ul>
</ol>
</div>
    <br class="clearfloat" />


    <div id="disqus_thread"></div>
    <script type="text/javascript" src="cssandjs/javascript/tongjianddisqus.js"></script>

    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    <div id="footer">
            zzqhost&nbsp;&copy;&nbsp;2012-2013&nbsp;
            <a href="http://www.zzqhost.com" target="_blank">www.zzqhost.com</a>
            <br>
            Generated by
            <a href="http://www.vim.org" target="_blank">Vim</a>
            &amp;
            <a href="http://code.google.com/p/vimwiki/" target="_blank">Vimwiki</a>
    </div>

</div>

</body>
</html>
